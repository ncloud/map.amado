/*
    Cornerstone Framework v2.0

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone","iscroll"],b):a.ScrollView=b(a.$,a._,a.Backbone)}(window,function(a,b,c){var d,e,f,g,h="featuredScrollView",i=".cs.scrollView",j=[{eventName:"pullDown",callbackName:"pullDownAction"},{eventName:"pullUp",callbackName:"pullUpAction"},{eventName:"refresh",callbackName:"onRefresh"},{eventName:"beforeScrollStart",callbackName:"onBeforeScrollStart"},{eventName:"start",callbackName:"onScrollStart"},{eventName:"beforeScrollMove",callbackName:"onBeforeScrollMove"},{eventName:"move",callbackName:"onScrollMove"},{eventName:"beforeScrollEnd",callbackName:"onBeforeScrollEnd"},{eventName:"scrollEnd",callbackName:"onScrollEnd"},{eventName:"touchEnd",callbackName:"onTouchEnd"},{eventName:"destroy",callbackName:"onDestroy"}],k=function(b,c){var d={scrollbars:!0,mouseWheel:!0,scrollbarClass:"scrollViewBar",interactiveScrollbars:!0,formFields:void 0,pullDownAction:void 0,pullUpAction:void 0,onRefresh:void 0,onBeforeScrollStart:void 0,onScrollStart:void 0,onBeforeScrollMove:void 0,onScrollMove:void 0,onBeforeScrollEnd:void 0,onScrollEnd:void 0,onTouchEnd:void 0,onDestroy:void 0};return this.$el=a(b),this.options=a.extend(!0,d,c),this.formCheck(),this.pullToRefresh(),this.$el.off("touchmove"+i).on("touchmove"+i,function(a){"range"!==a.target.type&&a.preventDefault()}),this.$el.off("mouseover"+i).on("mouseover"+i,function(){a(window).on("mousewheel"+i+" DOMMouseScroll"+i,function(a){var b=a.wheelDelta||-a.detail;this.scrollTop+=30*(0>b?1:-1),a.preventDefault()})}).off("mouseout"+i).on("mouseout"+i,function(){a(window).off("mousewheel"+i+" DOMMouseScroll"+i)}),this.options=this.addEventListener(this.options),this.iscroll=new iScroll(this.$el[0],this.options),this};return k.prototype.addEventListener=function(b){var c=this;return a(j).each(function(){var a=this,d=b[a.callbackName];b[a.callbackName]=function(){"function"==typeof d?d.call(this,arguments):d=function(){},c.$el.trigger(a.eventName+i)}}),b},k.prototype.destroy=function(){this.iscroll.destroy(),this.$el.off("touchmove"+i),this.$el.off("mouseover"+i),this.$el.off("mouseout"+i),a(window).off("mousewheel"+i+" DOMMouseScroll"+i),this.$el.data(h,null)},k.prototype.refresh=function(){this.iscroll.refresh()},k.prototype.formCheck=function(){if(!(!a.isEmptyObject(this.options)&&a.isArray(this.options.formFields)&&this.options.formFields.length>0))return!1;var b=this,c=function(c){for(var d=c.target,e=!0;1!=d.nodeType;)d=d.parentNode;a.grep(b.options.formFields,function(a){e=e&&d.tagName!=a}),e&&c.preventDefault()};this.defaultOptions.onBeforeScrollStart=c},k.prototype.pullToRefresh=function(){var a=this;if(d=a.$el.find('[data-featured-scrollview="pullDown"]'),f=a.$el.find('[data-featured-scrollview="pullUp"]'),!(this.options&&d.length&&f.length))return!1;e=d&&d[0].offsetHeight,g=f&&f[0].offsetHeight;var b=e,c=function(){d=a.$el.find('[data-featured-scrollview="pullDown"]'),e=d&&d[0].offsetHeight,f=a.$el.find('[data-featured-scrollview="pullUp"]'),g=f&&f[0].offsetHeight,d&&d.attr("class").match("loading")?d.removeClass("flip loading"):f&&f.attr("class").match("loading")&&f.removeClass("flip loading")},h=function(){d=a.$el.find('[data-featured-scrollview="pullDown"]'),e=d&&d[0].offsetHeight,f=a.$el.find('[data-featured-scrollview="pullUp"]'),g=f&&f[0].offsetHeight,this.y>5&&d&&!d.attr("class").match("flip")?(d.addClass("flip"),this.minScrollY=0):this.y<5&&d&&d.attr("class").match("flip")?(d.removeClass("flip loading"),this.minScrollY=-e):this.y<this.maxScrollY-5&&f&&!f.attr("class").match("flip")?(f.addClass("flip"),this.maxScrollY=this.maxScrollY):this.y>this.maxScrollY+5&&f&&f.attr("class").match("flip")&&(f.removeClass("flip loading"),this.maxScrollY=g)},i=function(){d=a.$el.find('[data-featured-scrollview="pullDown"]'),e=d&&d[0].offsetHeight,f=a.$el.find('[data-featured-scrollview="pullUp"]'),g=f&&f[0].offsetHeight,d&&d.attr("class").match("flip")?(d.addClass("loading"),a.options.pullDownAction&&a.options.pullDownAction()):d&&f.attr("class").match("flip")&&(f.addClass("loading"),a.options.pullUpAction&&a.options.pullUpAction())};this.options.topOffset=b,this.options.onRefresh=c,this.options.onScrollMove=h,this.options.onScrollEnd=i},a.fn[h]=function(b){return this.each(function(){var c=a(this),d=c.data(h);d||c.data(h,d=new k(this,b)),"string"==typeof b&&d[b](d.options)})},a(function(){a("[data-featured=scrollView]").each(function(){a(this)[h]()})}),c?c.View.extend({render:function(){return b.extend(this,this.$el.featuredScrollView(this.options).data("featuredScrollView")),this}}):k});
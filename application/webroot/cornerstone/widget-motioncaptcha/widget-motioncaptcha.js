/*
    Cornerstone Framework v2.0

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],b):a.Motioncaptcha=b(a.$,a._,a.Backbone)}(window,function(a,b,c){function d(a){this.init(a)}function f(a,b){this.X=a,this.Y=b}function g(a,b){return new f(a,b)}function h(a,b,c,d){this.X=a,this.Y=b,this.Width=c,this.Height=d}function i(a,b){this.Name=a,this.Points=l(b,w);var c=m(this.Points);this.Points=n(this.Points,-c),this.Points=o(this.Points,x),this.Points=p(this.Points,y),this.Vector=q(this.Points)}function j(a,b){this.Name=a,this.Score=b}function k(){this.Templates=[],this.Templates.push(new i("triangle",[g(137,139),g(135,141),g(133,144),g(132,146),g(130,149),g(128,151),g(126,155),g(123,160),g(120,166),g(116,171),g(112,177),g(107,183),g(102,188),g(100,191),g(95,195),g(90,199),g(86,203),g(82,206),g(80,209),g(75,213),g(73,213),g(70,216),g(67,219),g(64,221),g(61,223),g(60,225),g(62,226),g(65,225),g(67,226),g(74,226),g(77,227),g(85,229),g(91,230),g(99,231),g(108,232),g(116,233),g(125,233),g(134,234),g(145,233),g(153,232),g(160,233),g(170,234),g(177,235),g(179,236),g(186,237),g(193,238),g(198,239),g(200,237),g(202,239),g(204,238),g(206,234),g(205,230),g(202,222),g(197,216),g(192,207),g(186,198),g(179,189),g(174,183),g(170,178),g(164,171),g(161,168),g(154,160),g(148,155),g(143,150),g(138,148),g(136,148)])),this.Templates.push(new i("x",[g(87,142),g(89,145),g(91,148),g(93,151),g(96,155),g(98,157),g(100,160),g(102,162),g(106,167),g(108,169),g(110,171),g(115,177),g(119,183),g(123,189),g(127,193),g(129,196),g(133,200),g(137,206),g(140,209),g(143,212),g(146,215),g(151,220),g(153,222),g(155,223),g(157,225),g(158,223),g(157,218),g(155,211),g(154,208),g(152,200),g(150,189),g(148,179),g(147,170),g(147,158),g(147,148),g(147,141),g(147,136),g(144,135),g(142,137),g(140,139),g(135,145),g(131,152),g(124,163),g(116,177),g(108,191),g(100,206),g(94,217),g(91,222),g(89,225),g(87,226),g(87,224)])),this.Templates.push(new i("rectangle",[g(78,149),g(78,153),g(78,157),g(78,160),g(79,162),g(79,164),g(79,167),g(79,169),g(79,173),g(79,178),g(79,183),g(80,189),g(80,193),g(80,198),g(80,202),g(81,208),g(81,210),g(81,216),g(82,222),g(82,224),g(82,227),g(83,229),g(83,231),g(85,230),g(88,232),g(90,233),g(92,232),g(94,233),g(99,232),g(102,233),g(106,233),g(109,234),g(117,235),g(123,236),g(126,236),g(135,237),g(142,238),g(145,238),g(152,238),g(154,239),g(165,238),g(174,237),g(179,236),g(186,235),g(191,235),g(195,233),g(197,233),g(200,233),g(201,235),g(201,233),g(199,231),g(198,226),g(198,220),g(196,207),g(195,195),g(195,181),g(195,173),g(195,163),g(194,155),g(192,145),g(192,143),g(192,138),g(191,135),g(191,133),g(191,130),g(190,128),g(188,129),g(186,129),g(181,132),g(173,131),g(162,131),g(151,132),g(149,132),g(138,132),g(136,132),g(122,131),g(120,131),g(109,130),g(107,130),g(90,132),g(81,133),g(76,133)])),this.Templates.push(new i("circle",[g(127,141),g(124,140),g(120,139),g(118,139),g(116,139),g(111,140),g(109,141),g(104,144),g(100,147),g(96,152),g(93,157),g(90,163),g(87,169),g(85,175),g(83,181),g(82,190),g(82,195),g(83,200),g(84,205),g(88,213),g(91,216),g(96,219),g(103,222),g(108,224),g(111,224),g(120,224),g(133,223),g(142,222),g(152,218),g(160,214),g(167,210),g(173,204),g(178,198),g(179,196),g(182,188),g(182,177),g(178,167),g(170,150),g(163,138),g(152,130),g(143,129),g(140,131),g(129,136),g(126,139)])),this.Templates.push(new i("check",[g(91,185),g(93,185),g(95,185),g(97,185),g(100,188),g(102,189),g(104,190),g(106,193),g(108,195),g(110,198),g(112,201),g(114,204),g(115,207),g(117,210),g(118,212),g(120,214),g(121,217),g(122,219),g(123,222),g(124,224),g(126,226),g(127,229),g(129,231),g(130,233),g(129,231),g(129,228),g(129,226),g(129,224),g(129,221),g(129,218),g(129,212),g(129,208),g(130,198),g(132,189),g(134,182),g(137,173),g(143,164),g(147,157),g(151,151),g(155,144),g(161,137),g(165,131),g(171,122),g(174,118),g(176,114),g(177,112),g(177,114),g(175,116),g(173,118)])),this.Templates.push(new i("caret",[g(79,245),g(79,242),g(79,239),g(80,237),g(80,234),g(81,232),g(82,230),g(84,224),g(86,220),g(86,218),g(87,216),g(88,213),g(90,207),g(91,202),g(92,200),g(93,194),g(94,192),g(96,189),g(97,186),g(100,179),g(102,173),g(105,165),g(107,160),g(109,158),g(112,151),g(115,144),g(117,139),g(119,136),g(119,134),g(120,132),g(121,129),g(122,127),g(124,125),g(126,124),g(129,125),g(131,127),g(132,130),g(136,139),g(141,154),g(145,166),g(151,182),g(156,193),g(157,196),g(161,209),g(162,211),g(167,223),g(169,229),g(170,231),g(173,237),g(176,242),g(177,244),g(179,250),g(181,255),g(182,257)])),this.Templates.push(new i("zigzag",[g(307,216),g(333,186),g(356,215),g(375,186),g(399,216),g(418,186)])),this.Templates.push(new i("arrow",[g(68,222),g(70,220),g(73,218),g(75,217),g(77,215),g(80,213),g(82,212),g(84,210),g(87,209),g(89,208),g(92,206),g(95,204),g(101,201),g(106,198),g(112,194),g(118,191),g(124,187),g(127,186),g(132,183),g(138,181),g(141,180),g(146,178),g(154,173),g(159,171),g(161,170),g(166,167),g(168,167),g(171,166),g(174,164),g(177,162),g(180,160),g(182,158),g(183,156),g(181,154),g(178,153),g(171,153),g(164,153),g(160,153),g(150,154),g(147,155),g(141,157),g(137,158),g(135,158),g(137,158),g(140,157),g(143,156),g(151,154),g(160,152),g(170,149),g(179,147),g(185,145),g(192,144),g(196,144),g(198,144),g(200,144),g(201,147),g(199,149),g(194,157),g(191,160),g(186,167),g(180,176),g(177,179),g(171,187),g(169,189),g(165,194),g(164,196)])),this.Templates.push(new i("leftbracket",[g(140,124),g(138,123),g(135,122),g(133,123),g(130,123),g(128,124),g(125,125),g(122,124),g(120,124),g(118,124),g(116,125),g(113,125),g(111,125),g(108,124),g(106,125),g(104,125),g(102,124),g(100,123),g(98,123),g(95,124),g(93,123),g(90,124),g(88,124),g(85,125),g(83,126),g(81,127),g(81,129),g(82,131),g(82,134),g(83,138),g(84,141),g(84,144),g(85,148),g(85,151),g(86,156),g(86,160),g(86,164),g(86,168),g(87,171),g(87,175),g(87,179),g(87,182),g(87,186),g(88,188),g(88,195),g(88,198),g(88,201),g(88,207),g(89,211),g(89,213),g(89,217),g(89,222),g(88,225),g(88,229),g(88,231),g(88,233),g(88,235),g(89,237),g(89,240),g(89,242),g(91,241),g(94,241),g(96,240),g(98,239),g(105,240),g(109,240),g(113,239),g(116,240),g(121,239),g(130,240),g(136,237),g(139,237),g(144,238),g(151,237),g(157,236),g(159,237)])),this.Templates.push(new i("rightbracket",[g(112,138),g(112,136),g(115,136),g(118,137),g(120,136),g(123,136),g(125,136),g(128,136),g(131,136),g(134,135),g(137,135),g(140,134),g(143,133),g(145,132),g(147,132),g(149,132),g(152,132),g(153,134),g(154,137),g(155,141),g(156,144),g(157,152),g(158,161),g(160,170),g(162,182),g(164,192),g(166,200),g(167,209),g(168,214),g(168,216),g(169,221),g(169,223),g(169,228),g(169,231),g(166,233),g(164,234),g(161,235),g(155,236),g(147,235),g(140,233),g(131,233),g(124,233),g(117,235),g(114,238),g(112,238)])),this.Templates.push(new i("v",[g(89,164),g(90,162),g(92,162),g(94,164),g(95,166),g(96,169),g(97,171),g(99,175),g(101,178),g(103,182),g(106,189),g(108,194),g(111,199),g(114,204),g(117,209),g(119,214),g(122,218),g(124,222),g(126,225),g(128,228),g(130,229),g(133,233),g(134,236),g(136,239),g(138,240),g(139,242),g(140,244),g(142,242),g(142,240),g(142,237),g(143,235),g(143,233),g(145,229),g(146,226),g(148,217),g(149,208),g(149,205),g(151,196),g(151,193),g(153,182),g(155,172),g(157,165),g(159,160),g(162,155),g(164,150),g(165,148),g(166,146)])),this.Templates.push(new i("delete",[g(123,129),g(123,131),g(124,133),g(125,136),g(127,140),g(129,142),g(133,148),g(137,154),g(143,158),g(145,161),g(148,164),g(153,170),g(158,176),g(160,178),g(164,183),g(168,188),g(171,191),g(175,196),g(178,200),g(180,202),g(181,205),g(184,208),g(186,210),g(187,213),g(188,215),g(186,212),g(183,211),g(177,208),g(169,206),g(162,205),g(154,207),g(145,209),g(137,210),g(129,214),g(122,217),g(118,218),g(111,221),g(109,222),g(110,219),g(112,217),g(118,209),g(120,207),g(128,196),g(135,187),g(138,183),g(148,167),g(157,153),g(163,145),g(165,142),g(172,133),g(177,127),g(179,127),g(180,125)])),this.Templates.push(new i("star",[g(75,250),g(75,247),g(77,244),g(78,242),g(79,239),g(80,237),g(82,234),g(82,232),g(84,229),g(85,225),g(87,222),g(88,219),g(89,216),g(91,212),g(92,208),g(94,204),g(95,201),g(96,196),g(97,194),g(98,191),g(100,185),g(102,178),g(104,173),g(104,171),g(105,164),g(106,158),g(107,156),g(107,152),g(108,145),g(109,141),g(110,139),g(112,133),g(113,131),g(116,127),g(117,125),g(119,122),g(121,121),g(123,120),g(125,122),g(125,125),g(127,130),g(128,133),g(131,143),g(136,153),g(140,163),g(144,172),g(145,175),g(151,189),g(156,201),g(161,213),g(166,225),g(169,233),g(171,236),g(174,243),g(177,247),g(178,249),g(179,251),g(180,253),g(180,255),g(179,257),g(177,257),g(174,255),g(169,250),g(164,247),g(160,245),g(149,238),g(138,230),g(127,221),g(124,220),g(112,212),g(110,210),g(96,201),g(84,195),g(74,190),g(64,182),g(55,175),g(51,172),g(49,170),g(51,169),g(56,169),g(66,169),g(78,168),g(92,166),g(107,164),g(123,161),g(140,162),g(156,162),g(171,160),g(173,160),g(186,160),g(195,160),g(198,161),g(203,163),g(208,163),g(206,164),g(200,167),g(187,172),g(174,179),g(172,181),g(153,192),g(137,201),g(123,211),g(112,220),g(99,229),g(90,237),g(80,244),g(73,250),g(69,254),g(69,252)])),this.Templates.push(new i("pigtail",[g(81,219),g(84,218),g(86,220),g(88,220),g(90,220),g(92,219),g(95,220),g(97,219),g(99,220),g(102,218),g(105,217),g(107,216),g(110,216),g(113,214),g(116,212),g(118,210),g(121,208),g(124,205),g(126,202),g(129,199),g(132,196),g(136,191),g(139,187),g(142,182),g(144,179),g(146,174),g(148,170),g(149,168),g(151,162),g(152,160),g(152,157),g(152,155),g(152,151),g(152,149),g(152,146),g(149,142),g(148,139),g(145,137),g(141,135),g(139,135),g(134,136),g(130,140),g(128,142),g(126,145),g(122,150),g(119,158),g(117,163),g(115,170),g(114,175),g(117,184),g(120,190),g(125,199),g(129,203),g(133,208),g(138,213),g(145,215),g(155,218),g(164,219),g(166,219),g(177,219),g(182,218),g(192,216),g(196,213),g(199,212),g(201,211)])),this.Recognize=function(a){var b,c,d,e=+1/0,f=0;for(a=l(a,w),b=m(a),a=n(a,-b),d=q(a),c=0;c<this.Templates.length;c++){var g=r(this.Templates[c].Vector,d);e>g&&(e=g,f=c)}return new j(this.Templates[f].Name,1/e)}}function l(a,b){var c,d=u(a)/(b-1),e=0,f=new Array(a[0]);for(c=1;c<a.length;c++){var h=v(a[c-1],a[c]);if(e+h>=d){var i=a[c-1].X+(d-e)/h*(a[c].X-a[c-1].X),j=a[c-1].Y+(d-e)/h*(a[c].Y-a[c-1].Y),k=g(i,j);f[f.length]=k,a.splice(c,0,k),e=0}else e+=h}return f.length==b-1&&(f[f.length]=g(a[a.length-1].X,a[a.length-1].Y)),f}function m(a){var b=s(a);return Math.atan2(b.Y-a[0].Y,b.X-a[0].X)}function n(a,b){var c,d=s(a),e=Math.cos(b),f=Math.sin(b),h=[];for(c=0;c<a.length;c++){var i=(a[c].X-d.X)*e-(a[c].Y-d.Y)*f+d.X,j=(a[c].X-d.X)*f+(a[c].Y-d.Y)*e+d.Y;h[h.length]=g(i,j)}return h}function o(a,b){var c,d=t(a),e=[];for(c=0;c<a.length;c++){var f=a[c].X*(b/d.Width),h=a[c].Y*(b/d.Height);e[e.length]=g(f,h)}return e}function p(a,b){var c,d=s(a),e=[];for(c=0;c<a.length;c++){var f=a[c].X+b.X-d.X,h=a[c].Y+b.Y-d.Y;e[e.length]=g(f,h)}return e}function q(a){var b,c,d=0,e=[];for(b=0;b<a.length;b++)e[e.length]=a[b].X,e[e.length]=a[b].Y,d+=a[b].X*a[b].X+a[b].Y*a[b].Y;for(c=Math.sqrt(d),b=0;b<e.length;b++)e[b]/=c;return e}function r(a,b){var c,d,e=0,f=0;for(c=0;c<a.length;c+=2)e+=a[c]*b[c]+a[c+1]*b[c+1],f+=a[c]*b[c+1]-a[c+1]*b[c];return d=Math.atan(f/e),Math.acos(e*Math.cos(d)+f*Math.sin(d))}function s(a){var b,c=0,d=0;for(b=0;b<a.length;b++)c+=a[b].X,d+=a[b].Y;return c/=a.length,d/=a.length,g(c,d)}function t(a){var b,c=+1/0,d=-1/0,e=+1/0,f=-1/0;for(b=0;b<a.length;b++)a[b].X<c&&(c=a[b].X),a[b].X>d&&(d=a[b].X),a[b].Y<e&&(e=a[b].Y),a[b].Y>f&&(f=a[b].Y);return new h(c,e,d-c,f-e)}function u(a){var b,c=0;for(b=1;b<a.length;b++)c+=v(a[b-1],a[b]);return c}function v(a,b){var c=b.X-a.X,d=b.Y-a.Y;return Math.sqrt(c*c+d*d)}a.fn.motioncaptcha=function(b){return this.each(function(){function c(a){var b,c;return a.touches&&a.touches.length>0?(b=a.touches[0].pageX-l.offset().left+o,c=a.touches[0].pageY-l.offset().top+p):a.offsetX?(b=a.offsetX-o,c=a.offsetY-p):(b=a.pageX-l.offset().left-o,c=a.pageY-l.offset().top-p),[b,c]}var f=a.extend({},a.fn.motioncaptcha.defaults,b);f.actionId="#"+f.actionId.replace(/\#/g,""),f.canvasId="#"+f.canvasId.replace(/\#/g,""),f.divId="#"+f.divId.replace(/\#/g,""),f.submitId=f.submitId?"#"+f.submitId.replace(/\#/g,""):!1;var h,i=!1,j=(a("body"),a(this)),l=(a(f.divId),a(f.canvasId)),m=l.width(),n=l.height(),o=1*l.css("borderLeftWidth").replace("px",""),p=1*l.css("borderTopWidth").replace("px","");l[0].width=m,l[0].height=n;var q=l[0].getContext("2d");q.canvasWidth=m,q.canvasHeight=n,q.font=f.canvasFont,q.fillStyle=f.canvasTextColor,l.addClass(f.shapes[Math.floor(Math.random()*f.shapes.length)]);var r=!1,s=!1,t=[],u=new k,v=navigator.userAgent.match(/Android/);h=new d(q);var w=function(b){if(i)return!1;b.preventDefault();var d=c(b),f=d[0],j=d[1];return r=!0,s=!0,!v&&a("body").addClass("mc-noselect"),q.clearRect(0,0,m,n),h.strokeStart(f,j),l.removeClass("mc-invalid mc-valid"),t=[g(f,j)],l.trigger(e=a.Event("start.cs.motionCaptcha")),!1},x=function(b){if(s)return s=0;if(!i&&r){b.preventDefault();var d=c(b),f=d[0],j=d[1];t[t.length]=g(f,j),h.stroke(f,j),l.trigger(e=a.Event("move.cs.motionCaptcha"))}return!1},y=function(){if(!i&&r)if(r=!1,a("body").removeClass("mc-noselect"),t.length>=10){var b=u.Recognize(t);l.attr("class").match(b.Name)&&b.Score>.7?(i=1,setTimeout(h.destroy,500),l.addClass("mc-valid"),q.fillText(f.successMsg,10,24),l.trigger(e=a.Event("success.cs.motionCaptcha")),f.onSuccess(j,l,q)):(l.addClass("mc-invalid"),q.fillText(f.errorMsg,10,24),l.trigger(e=a.Event("fail.cs.motionCaptcha")),f.onError(j,l,q))}else l.addClass("mc-invalid"),q.fillText(f.errorMsg,10,24),l.trigger(e=a.Event("fail.cs.motionCaptcha")),f.onError(j,l,q);return l.trigger(e=a.Event("end.cs.motionCaptcha")),!1};"ontouchstart"in window?(l[0].addEventListener("touchstart",w,!1),l[0].addEventListener("touchmove",x,!1),l[0].addEventListener("touchend",y,!1)):l.bind({mousedown:w,mousemove:x,mouseup:y}),j.addClass(f.cssClass.replace(/\./,""))})},a.fn.motioncaptcha.defaults={actionId:"#mc-action",divId:"#mc",canvasId:"#mc-canvas",submitId:!1,cssClass:".mc-active",shapes:["triangle","x","rectangle","circle","check","caret","zigzag","arrow","leftbracket","rightbracket","v","delete","star","pigtail"],canvasFont:'15px "Lucida Grande"',canvasTextColor:"#111",errorMsg:"다시 시도해주세요.",successMsg:"성공!",noCanvasMsg:"Your browser doesn't support <canvas> - try Chrome, FF4, Safari or IE9.",label:"<p>Please draw the shape in the box to submit the form:</p>",onSuccess:function(b){var c=this,d=c.submitId?b.find(c.submitId):b.find("input[type=submit]:disabled");b.attr("action",a(c.actionId).val()),d.prop("disabled",!1)},onError:function(){}},d.prototype={ctx:null,X:null,Y:null,painters:null,interval:null,init:function(a){function b(){var a;for(c.ctx.lineWidth=e,c.ctx.strokeStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+.06+")",a=0;a<c.painters.length;a++)c.ctx.beginPath(),c.ctx.moveTo(c.painters[a].dx,c.painters[a].dy),c.painters[a].dx-=c.painters[a].ax=(c.painters[a].ax+(c.painters[a].dx-c.X)*c.painters[a].div)*c.painters[a].ease,c.painters[a].dy-=c.painters[a].ay=(c.painters[a].ay+(c.painters[a].dy-c.Y)*c.painters[a].div)*c.painters[a].ease,c.ctx.lineTo(c.painters[a].dx,c.painters[a].dy),c.ctx.stroke()}var c=this,d=navigator.userAgent.toLowerCase(),e=d.search("android")>-1||d.search("iphone")>-1?2:1,f=[0,0,0];this.ctx=a,this.ctx.globalCompositeOperation="source-over",this.X=this.ctx.canvasWidth/2,this.Y=this.ctx.canvasHeight/2,this.painters=[];for(var g=0;38>g;g++)this.painters.push({dx:this.ctx.canvasWidth/2,dy:this.ctx.canvasHeight/2,ax:0,ay:0,div:.1,ease:.18*Math.random()+.6});this.interval=setInterval(b,1e3/60)},destroy:function(){clearInterval(this.interval)},strokeStart:function(a,b){this.X=a,this.Y=b;for(var c=0;c<this.painters.length;c++)this.painters[c].dx=a,this.painters[c].dy=b;this.shouldDraw=!0},stroke:function(a,b){this.X=a,this.Y=b}};var w=64,x=250,y=g(0,0);return c&&c.View.extend({render:function(a){return"string"==typeof a?this.$el.motioncaptcha(a):this.$el.motioncaptcha(this.options),this}})});
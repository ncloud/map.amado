/*
    Cornerstone Framework v2.0

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone","infinity"],b):a.ListView=b(a.$,a._,a.Backbone)}(window,function(a,b,c){var d,e,f,g="featuredListView",h=function(b,c){var g=this;f={$scroller:a(window),optimization:!0,SCROLL_THROTTLE:0,PAGE_TO_SCREEN_RATIO:3,scrollEndAction:function(){}},this.$el=a(b),this.options=c=a.extend(!0,f,c),infinity.config.SCROLL_THROTTLE=this.options.SCROLL_THROTTLE,infinity.config.PAGE_TO_SCREEN_RATIO=this.options.PAGE_TO_SCREEN_RATIO,d=infinity.ListView,e=infinity.ListItem,this.$el.each(function(){if(c.optimization){var b=g.$el.html();g.$el.html("");var e=new d(a(this));a(this).data("listView",e),g.$el.data("listView").append(b)}}),this.scrollHeight=navigator.userAgent.match(":*iPhone:*")&&!window.navigator.standalone?60:0;var h=0,i=function(){c.scrollEndAction(),g.$el.trigger("scrollEnd.cs.listView")};c.$scroller.on("scroll.cs.listView",function(b){b.target.tagName?a(this)[0].scrollHeight-a(this).scrollTop()==a(this).outerHeight()&&i():(h=navigator.userAgent.match("Android")?a(window).scrollTop()+100:a(window).scrollTop(),h>=a(document).height()-a(window).height()-g.scrollHeight&&i())})};return h.prototype.addItem=function(b){this.options.optimization?this.$el.data("listView").append(a(b)):this.$el.append(b),this.refresh(),this.$el.trigger("listView.addItem.done")},h.prototype.removeItem=function(a){if(this.options.optimization){var b=this.$el.data("listView");b.cleanup(),a.remove()}else a.remove();this.refresh(),this.$el.trigger("listView.removeItem.done")},h.prototype.refresh=function(){if(this.options.optimization){var b=this.$el.children("div").find("div").eq(0).height(),c=1.5*this.$el.find("[data-list-itemid]").outerHeight();this.$el.find("[data-infinity-pageid]").each(function(){b+=a(this).height()}),3===this.$el.find("[data-infinity-pageid]").length&&(b+=c),this.$el.children("div").css("height",b)}},h.prototype.scrollHandler=function(){this.$el.data("listView").scrollHandler()},a.fn[g]=function(b,c){return this.each(function(){var d=a(this),e=d.data(g);e||d.data(g,e=new h(this,b)),"string"==typeof b&&e[b](c)})},a.fn[g].Constructor=h,a(function(){a("[data-featured=listView]").each(function(){a(this)[g]()})}),c?c.View.extend({tagName:"ul",collectionItems:"items",initialize:function(a){this.options=a,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset",this.reset)},addAll:function(){this.collection.forEach(this.addOne,this)},addOne:function(a){var b=this.$el.data(g);b||this.$el.featuredListView(this.options);var c=this.options.itemView,d=new c({model:a});d.render(),d.$el.attr("data-list-itemid",a.cid),this.$el.featuredListView("addItem",d.el)},removeOne:function(a){var b=this.$el.find("[data-list-itemid="+a.cid+"]");this.$el.featuredListView("removeItem",b)},reset:function(){this.$el.data(g,null),a(window).off("scroll.cs.listView"),this.$el.empty()},render:function(){return this.$el.featuredListView(this.options),this.addAll(),this}}):h});